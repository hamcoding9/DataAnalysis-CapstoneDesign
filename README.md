# DataAnalysis-CapstoneDesign

* GPT2 기반 산문시 생성 모델

* 2022-1학기 경희대학교 데이터분석캡스톤디자인

* 개발 기간: 2022.03 ~ 2022.06

## 1. 소개

### 과제 개요

시는 특정한 목적을 갖고 있지 않고 순간의 감각과 함축적인 의미를 드러내야 하기 때문에 쓰기 어렵다. 따라서 시 생성은 텍스트 생성 분야의 흥미롭고 어려운 과제이다. 본 과제는 양질의 시 데이터를 준비해 문장 생성 모델이 예술적인 글쓰기를 학습하여 산문시를 쓸 수 있게 한다.

본 프로젝트에서 정의하는 산문시란 한 단락으로 되어 있으며, 시를 미적으로 만드는 형식(운율, 함축, 모호성, 이미지)을 갖추고 있는 글을 의미한다.

### 주요 내용

* 양질의 시 데이터를 수집하고 전처리한다.
* GPT를 fine-tuning하여 예술적인 글쓰기를 학습시킨다.
* 완성된 모델은 input으로 단어 혹은 문장을 받아 뒤를 잇는 방식으로 산문시를 생성한다.
* 높은 품질의 생성 결과와 낮은 품질의 생성 결과에 따라 원인을 분석하고 데이터를 후처리한다.
* 안정적인 샘플을 생성하도록 모델을 수정한다.

## 2. 학습

### 데이터

창작물을 공유하는 플랫폼을 크롤링하여 시 데이터를 수집하였다. 최종적으로 사용한 데이터는 800KB의 텍스트 파일이다.

### 언어 및 라이브러리

python, pytorch

## 3. 생성

### Top-p, Top-k

1. Top-k: 모델이 예측한 다음 토큰 확률 분포에서 확률값이 가장 높은 k개 토큰 가운데 하나를 다음 토큰으로 선택하는 기법이다.

2. Top-p: 모델이 예측한 다음 토큰 확률 분포에서 확률값이 높은 순서대로 내림차순 정렬을 한 뒤 누적 확률값이 p이상인 최소 개수의 토큰 집합 가운데 하나를 다음 토큰으로 선택하는 기법이다.

두 방식을 모두 섞어서 사용. Top-k =  80, Top-p = 0.95

### 생성 함수

```python
def make_prose(input, line, max_len):
    prose = ""
    for i in range(line):
        input = "</s>" + input + "</s>"
        prose = generate_text(input, max_len)
        input = prose
    print(prose)
```

* `input`: 시의 첫 번째 문장 입력
* `line`: 시를 이루는 전체 문장 수
* `max_len`: 한 문장당 최대 글자 수

### 생성 예시

```
나는 맨발로 계단을 오른다. 네게 손을 내밀어주러 간다. 그제야 멈춰버린 길이 보인다. 어젯밤 나는 무언가를 잊은 것 같다. 
나는 아직도 꿈틀대는 눈동자를 본다. 어떤 문장들은 멀쩡히 잘하고 어떤 문장들은 그대의 손을 떠나간다. 나는 너와 같은 문장들을 계속 찾고 있다.
```

```
나는 맨발로 계단을 오른다. 몇 개의 버튼을 눌렀을 때 왼쪽 무릎에서 심장 쪽으로 내려오는 힘이 빠졌을 때 비로소 뛰었다. 
뛰어내린 사람은 없지만 나는 뛰었다. 나는 숨을 쉬고 있는 사람을 보며 숨을 참는다.
```

```
나는 맨발로 계단을 오른다. 밟아도 괜찮을 거라고 생각한 나는 발을 딛을 힘조차 없다. 그저 걷는 것만으로 만족한다. 
걷고 있는 시간이 인생의 전부라는 생각은 어리석다. 걷고 또 걷다 보면 하루가 지나가는 시간이 한 번씩 나에게 찾아오는 것이다. 
새벽녘 해가 뜨는 시간처럼 누군가에게 전화는 하지 않아도 좋겠다.
```
